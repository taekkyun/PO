---
title: "R Notebook"
description : Codes were generated by Taek-Kyun Kim on Feb 14, 2019
              Copyright at Institute for Systems Biology
output: html_notebook
---

# 00. Libraries required
```{r}
require(pROC)
require(switchBox)
require(caret)
require(mdatools)

```



# 01. Import Stanford 82 and 11 
```{r}
StanfordGenes <- read.table("[path]/StanfordGenes.txt", sep="\t", header=T)
stanford82.genes <- as.character(StanfordGenes$Stanford82)
stanford82alias.genes <- as.character(StanfordGenes$Stanford82alias)
stanford82.foldDirection <- as.numeric(StanfordGenes$FoldDirection)
stanford82.stanford11 <- StanfordGenes$Stanford11
stanford11.genes <- as.character(StanfordGenes$Stanford82[which(StanfordGenes$Stanford11 == 1)])
stanford11alias.genes <- as.character(StanfordGenes$Stanford82alias[which(StanfordGenes$Stanford11 == 1)])
stanford11.foldDirection <- as.numeric(StanfordGenes$FoldDirection[which(StanfordGenes$Stanford11 == 1)])
rm(StanfordGenes)

```



# 02. Function for generation of expression profiling matrix for Stanford 82 and 11 
```{r}
matrix82 <- function (data, gene, sample) {
  rownum <- length(stanford82.genes)
  colnum <- ncol(data)
  tMat <- matrix(0, rownum, colnum)
  
  for ( i in 1:rownum ) {
    tid <- which(gene == stanford82.genes[i])
    tidAlias <- which(gene == stanford82alias.genes[i])
    if ( length(tid) > 1 | length(tidAlias) > 1 ) {
      if ( length(tid) > 1 ) {
        tMat[i, ] <- colMeans(data[tid, ])
      } else {
        tMat[i, ] <- colMeans(data[tidAlias, ])
      }
    } else if ( length(tid) == 1 | length(tidAlias) == 1) {
      if ( length(tid) == 1 ) {
        tMat[i, ] <- t(data[tid, ])
      } else {
        tMat[i, ] <- t(data[tidAlias, ])
      }
    } 
  }
  return(tMat)
}

matrix11 <- function (data, gene, sample) {
  rownum <- length(stanford11.genes)
  colnum <- ncol(data)
  tMat <- matrix(0, rownum, colnum)
  
  for ( i in 1:rownum ) {
    tid <- which(gene == stanford82.genes[i])
    tidAlias <- which(gene == stanford82alias.genes[i])
    if ( length(tid) > 1 | length(tidAlias) > 1 ) {
      if ( length(tid) > 1 ) {
        tMat[i, ] <- colMeans(data[tid, ])
      } else {
        tMat[i, ] <- colMeans(data[tidAlias, ])
      }
    } else if ( length(tid) == 1 | length(tidAlias) == 1) {
      if ( length(tid) == 1 ) {
        tMat[i, ] <- t(data[tid, ])
      } else {
        tMat[i, ] <- t(data[tidAlias, ])
      }
    } 
  }
  return(tMat)
}
```



# 03. Import discovery data set1 - GSE28750 
```{r}
data <- read.table("[path]/GSE28750_expr_TK.txt",sep="\t",header=T)
GSE28750_gene <- data[,2]
GSE28750_expr <- data[,3:ncol(data)]
GSE28750_sample <- read.table("[path]/GSE28750_sampleinfo_TK.txt",sep="\t",header=T)

GSE28750_expr <- matrix82(GSE28750_expr[, which(GSE28750_sample$selected == 1)], 
                          GSE28750_gene, 
			  GSE28750_sample[which(GSE28750_sample$selected == 1),])
GSE28750_sample <- GSE28750_sample[which(GSE28750_sample$selected == 1),]
rm(GSE28750_gene)
```



# 04. Import discovery data set2 - GSE32707 
```{r}
data <- read.table("[path]/GSE32707_expr_TK.txt",sep="\t",header=T)
GSE32707_gene <- data[,2]
GSE32707_expr <- data[,3:ncol(data)]
GSE32707_sample <- read.table("[path]/GSE32707_sampleinfo_TK.txt",sep="\t",header=T)

GSE32707_expr <- matrix82(GSE32707_expr[, which(GSE32707_sample$selected == 1)], 
                          GSE32707_gene, 
			  GSE32707_sample[which(GSE32707_sample$selected == 1),])
GSE32707_sample <- GSE32707_sample[which(GSE32707_sample$selected == 1),]
rm(GSE32707_gene)
```



# 05. Import discovery data set3 - GSE40012 
```{r}
data <- read.table("[path]/GSE40012_expr_TK.txt",sep="\t",header=T)
GSE40012_gene <- data[,2]
GSE40012_expr <- data[,3:ncol(data)]
GSE40012_sample <- read.table("[path]/GSE40012_sampleinfo_TK.txt",sep="\t",header=T)

GSE40012_expr <- matrix82(GSE40012_expr[, which(GSE40012_sample$selected == 1)], 
                          GSE40012_gene, 
                          GSE40012_sample[which(GSE40012_sample$selected == 1),])
GSE40012_sample <- GSE40012_sample[which(GSE40012_sample$selected == 1),]
rm(GSE40012_gene)
```



# 06. Import discovery data set4 - GSE66099 
```{r}
data <- read.table("[path]/GSE66099_gcrma_normalized.csv",sep=",",header=T)
GSE66099_expr <- data[,2:ncol(data)]
GSE66099_sample <- read.table("[path]/GSE66099_sampleinfo_TK.txt",sep="\t",header=T)
data <- read.table("[path]/GSE66099_annot.txt",sep="\t",header=T)
GSE66099_gene <- data[,2]

GSE66099_expr <- matrix82(GSE66099_expr[, which(GSE66099_sample$selected == 1)], 
                          GSE66099_gene, 
                          GSE66099_sample[which(GSE66099_sample$selected == 1),])
GSE66099_sample <- GSE66099_sample[which(GSE66099_sample$selected == 1),]
rm(GSE66099_gene)
```



# 07. Import discovery data set5 - GSE36809 
```{r}
data <- read.table("[path]/GSE36809_gcrma_normalized.csv",sep=",",header=T)
GSE36809_expr <- data[,2:ncol(data)]
GSE36809_sample <- read.table("[path]/GSE36809_sampleinfo_TK.txt",sep="\t",header=T)
data <- read.table("[path]/GSE36809_annot.txt",sep="\t",header=T)
GSE36809_gene <- data[,2]
GSE36809_expr1 <- matrix82(GSE36809_expr[, which(GSE36809_sample$selected == 1)], 
                           GSE36809_gene, 
                           GSE36809_sample[which(GSE36809_sample$selected == 1),])
GSE36809_sample1 <- GSE36809_sample[which(GSE36809_sample$selected == 1),]
GSE36809_expr2 <- matrix82(GSE36809_expr[, which(GSE36809_sample$selected == 2)], 
                           GSE36809_gene, 
                           GSE36809_sample[which(GSE36809_sample$selected == 2),])
GSE36809_sample2 <- GSE36809_sample[which(GSE36809_sample$selected == 2),]
GSE36809_expr3 <- matrix82(GSE36809_expr[, which(GSE36809_sample$selected == 3)], 
                           GSE36809_gene, 
                           GSE36809_sample[which(GSE36809_sample$selected == 3),])
GSE36809_sample3 <- GSE36809_sample[which(GSE36809_sample$selected == 3),]
GSE36809_expr4 <- matrix82(GSE36809_expr[, which(GSE36809_sample$selected == 4)], 
                           GSE36809_gene, 
                           GSE36809_sample[which(GSE36809_sample$selected == 4),])
GSE36809_sample4 <- GSE36809_sample[which(GSE36809_sample$selected == 4),]
GSE36809_expr5 <- matrix82(GSE36809_expr[, which(GSE36809_sample$selected == 5)], 
                           GSE36809_gene, 
                           GSE36809_sample[which(GSE36809_sample$selected == 5),])
GSE36809_sample5 <- GSE36809_sample[which(GSE36809_sample$selected == 5),]

#GSE36809_expr <- matrix82(GSE36809_expr, GSE36809_gene, GSE36809_sample)
rm(GSE36809_expr)
rm(GSE36809_gene)

```



# 08. Import validation data set1 - GSE65682 
```{r}
data <- read.table("[path]/GSE65682_rma_normalized.csv",sep=",",header=T)
GSE65682_expr <- data[,2:ncol(data)]
GSE65682_sample <- read.table("[path]/GSE65682_sampleinfo_TK.txt",sep="\t",header=T)
data <- read.table("[path]/GSE65682_annot.txt",sep="\t",header=T)
GSE65682_gene <- data[,2]

GSE65682_expr <- matrix82(GSE65682_expr[, which(GSE65682_sample$selected == 1)], 
                          GSE65682_gene, 
			  GSE65682_sample[which(GSE65682_sample$selected == 1),])
GSE65682_sample <- GSE65682_sample[which(GSE65682_sample$selected == 1),]
rm(GSE65682_gene)

```



# 09. Import validation data set2 - GSE74224 
```{r}
data <- read.table("[path]/GSE74224_rma_normalized.csv",sep=",",header=T)
GSE74224_gene <- data[,2]
GSE74224_expr <- data[,3:ncol(data)]
GSE74224_sample <- read.table("[path]/GSE74224_sampleinfo_TK.txt",sep="\t",header=T)

GSE74224_expr <- matrix82(GSE74224_expr[, which(GSE74224_sample$selected == 1)], 
                          GSE74224_gene, 
			  GSE74224_sample[which(GSE74224_sample$selected == 1),])
GSE74224_sample <- GSE74224_sample[which(GSE74224_sample$selected == 1),]
rm(GSE74224_gene)

```



# 10. Import validation data set3 - E-MEXP-3589 
```{r}
data <- read.table("[path]/E-MEXP-3589_expr_TK.txt", sep="\t",header=T)
EMEXP3589_gene <- data[,2]
EMEXP3589_expr <- data[,3:ncol(data)]
EMEXP3589_sample <- read.table("[path]/E-MEXP-3589_sampleinfo_TK.txt",sep="\t",header=T)

EMEXP3589_expr <- matrix82(EMEXP3589_expr[, which(EMEXP3589_sample$selected == 1)], 
                           EMEXP3589_gene, 
			   EMEXP3589_sample[which(EMEXP3589_sample$selected == 1),])
EMEXP3589_sample <- EMEXP3589_sample[which(EMEXP3589_sample$selected == 1),]
rm(EMEXP3589_gene)
```



# 11. AUC calculation
```{r}
AUCcalc <- function (data, sample, genes) {
  data_expr <- data
  data_sample <- sample
  
  #sepsisid <- which(data_sample$selected == 1 & data_sample$group == "Sepsis")
  sepsisid <- which(data_sample$group == "Sepsis")
  #sirsid <- which(data_sample$selected == 1 & data_sample$group == "SIRS")
  sirsid <- which(data_sample$group == "SIRS")

  #gid <- which(is.element(stanford82.genes, genes))
  
  gid <- c()
  for ( i in 1:length(genes) ){
    tid <- which(stanford82.genes == genes[i])
    gid <- c(gid, tid)
  }
  folddirection <- stanford82.foldDirection[gid]
  
  tMat <- data_expr[gid, c(sepsisid,sirsid)]
  
  # check zero in matrix
  tid <- which(tMat[,1] != 0)
  tMat <- tMat[tid, ]
  folddirection <- folddirection[tid]
  
  # AUC calculation
  numcol <- ncol(tMat)
  posid <- which(folddirection > 0)
  negid <- which(folddirection < 0)
  
  SMS <- rep(0,numcol)
  for ( i in 1:numcol ) {
    if ( length(posid) > 0 && length(negid) > 0 ) {
      posExp <- exp(mean(log(tMat[posid,i])))
      negExp <- exp(mean(log(tMat[negid,i])))
      weight <- length(negid) / length(posid)
      SMS[i] <- posExp - (negExp * weight)
    } else if ( length(posid) > 0 && length(negid) == 0 ) {
      posExp <- exp(mean(log(tMat[posid,i])))
      SMS[i] <- posExp
    } else if ( length(posid) == 0 && length(negid) > 0 ) {
      negExp <- exp(mean(log(tMat[negid,i])))
      SMS[i] <- -negExp
    } else {
      SMS[i] <- 0
    }
  }
  
  class <- factor(data_sample$group[c(sepsisid,sirsid)], levels = c("Sepsis", "SIRS"))
  library(pROC)
  roc_obj <- roc(class, SMS, ci=T)
  return(roc_obj)
  
}
```



# 12. AUC for stanford11 
```{r}
library(pROC)

AUCs_stanford <- rep(0,12,1)
AUCs_stanford_ci <- matrix(0,12,3)

tm <- AUCcalc(GSE28750_expr, GSE28750_sample, stanford11.genes)
AUCs_stanford[1] <- tm$auc
AUCs_stanford_ci[1,] <- t(as.matrix(tm$ci))
tm <- AUCcalc(GSE32707_expr, GSE32707_sample, stanford11.genes)
AUCs_stanford[2] <- tm$auc
AUCs_stanford_ci[2,] <- t(as.matrix(tm$ci))
tm <- AUCcalc(GSE40012_expr, GSE40012_sample, stanford11.genes)
AUCs_stanford[3] <- tm$auc
AUCs_stanford_ci[3,] <- t(as.matrix(tm$ci))
tm <- AUCcalc(GSE66099_expr, GSE66099_sample, stanford11.genes)
AUCs_stanford[4] <- tm$auc
AUCs_stanford_ci[4,] <- t(as.matrix(tm$ci))
tm <- AUCcalc(GSE36809_expr1, GSE36809_sample1, stanford11.genes)
AUCs_stanford[5] <- tm$auc
AUCs_stanford_ci[5,] <- t(as.matrix(tm$ci))
tm <- AUCcalc(GSE36809_expr2, GSE36809_sample2, stanford11.genes)
AUCs_stanford[6] <- tm$auc
AUCs_stanford_ci[6,] <- t(as.matrix(tm$ci))
tm <- AUCcalc(GSE36809_expr3, GSE36809_sample3, stanford11.genes)
AUCs_stanford[7] <- tm$auc
AUCs_stanford_ci[7,] <- t(as.matrix(tm$ci))
tm <- AUCcalc(GSE36809_expr4, GSE36809_sample4, stanford11.genes)
AUCs_stanford[8] <- tm$auc
AUCs_stanford_ci[8,] <- t(as.matrix(tm$ci))
tm <- AUCcalc(GSE36809_expr5, GSE36809_sample5, stanford11.genes)
AUCs_stanford[9] <- tm$auc
AUCs_stanford_ci[9,] <- t(as.matrix(tm$ci))
tm <- AUCcalc(GSE65682_expr, GSE65682_sample, stanford11.genes)
AUCs_stanford[10] <- tm$auc
AUCs_stanford_ci[10,] <- t(as.matrix(tm$ci))
tm <- AUCcalc(GSE74224_expr, GSE74224_sample, stanford11.genes)
AUCs_stanford[11] <- tm$auc
AUCs_stanford_ci[11,] <- t(as.matrix(tm$ci))
tm <- AUCcalc(EMEXP3589_expr, EMEXP3589_sample, stanford11.genes)
AUCs_stanford[12] <- tm$auc
AUCs_stanford_ci[12,] <- t(as.matrix(tm$ci))
colnames(AUCs_stanford_ci) <- c("95% lower", "AUC", "95% upper")
```



# 13. [Figure 2 - preparation] Generation of random gene set
```{r}
AUCs <- matrix(0,100000,12)
randGenes100000 <- rep('', 100000)
for ( i in c(1:nrow(AUCs)) ) {
  tGenes <- stanford82.genes[sample(1:82, 11, replace=F)]
  randGenes100000[i] <- paste(tGenes, collapse=", ")
  tm <- AUCcalc(GSE28750_expr, GSE28750_sample, tGenes)
  AUCs[i, 1] <- tm$auc
  tm <- AUCcalc(GSE32707_expr, GSE32707_sample, tGenes)
  AUCs[i, 2] <- tm$auc
  tm <- AUCcalc(GSE40012_expr, GSE40012_sample, tGenes)
  AUCs[i, 3] <- tm$auc
  tm <- AUCcalc(GSE66099_expr, GSE66099_sample, tGenes)
  AUCs[i, 4] <- tm$auc
  tm <- AUCcalc(GSE36809_expr1, GSE36809_sample1, tGenes)
  AUCs[i, 5] <- tm$auc
  tm <- AUCcalc(GSE36809_expr2, GSE36809_sample2, tGenes)
  AUCs[i, 6] <- tm$auc
  tm <- AUCcalc(GSE36809_expr3, GSE36809_sample3, tGenes)
  AUCs[i, 7] <- tm$auc
  tm <- AUCcalc(GSE36809_expr4, GSE36809_sample4, tGenes)
  AUCs[i, 8] <- tm$auc
  tm <- AUCcalc(GSE36809_expr5, GSE36809_sample5, tGenes)
  AUCs[i, 9] <- tm$auc
  tm <- AUCcalc(GSE65682_expr, GSE65682_sample, tGenes)
  AUCs[i, 10] <- tm$auc
  tm <- AUCcalc(GSE74224_expr, GSE74224_sample, tGenes)
  AUCs[i, 11] <- tm$auc
  tm <- AUCcalc(EMEXP3589_expr, EMEXP3589_sample, tGenes)
  AUCs[i, 12] <- tm$auc
}

resMat <- AUCs

row.names(resMat) <- randGenes100000
colnames(resMat) <- c("GSE28750",
                      "GSE32707",
                      "GSE40012",
                      "GSE66099",
                      "GSE36809-1",
                      "GSE36809-2",
                      "GSE36809-3",
                      "GSE36809-4",
                      "GSE36809-5",
                      "GSE65682",
                      "GSE74224",
                      "E-MEXP-3589")
write.table(resMat, "[path]/AUCs_randGenes11_100000.txt", sep="\t")

```



# 14. [Figure 2 - preparation] GO biological processes
```{r}
data <- read.table("[path]/GOBP_82genes_matrix.txt", sep="\t", header=T)
GOBP82 <- data[,1]
GOBP82mat <- data[,4:ncol(data)]
GOBP82genes <- colnames(data[,4:ncol(data)])
GOBP82_stanford11 <- data[,2]
GOBP82_stanford11_v2 <- data[,3]

tid <- which(GOBP82genes == "HLA.DPB1")
GOBP82genes[tid] <- "HLA-DPB1"

rand100000_gobp_mat <- matrix(0, 100000, 503)

for ( i in c(1:100000) ) {
  tGenes <- unlist(strsplit(randGenes100000[i], ", "))
  tid <- is.element(GOBP82genes, tGenes)
  rand100000_gobp_mat[i, ] <- t(rowSums(GOBP82mat[,tid]))
}
```



# 15. [Figure 2A] Weighted AUC & Summary of GOBPs 
```{r}
# number of samples
sampleN <- rep(0,12)
sampleN[1] <- length(which(GSE28750_sample$selected == 1))
sampleN[2] <- length(which(GSE32707_sample$selected == 1))
sampleN[3] <- length(which(GSE40012_sample$selected == 1))
sampleN[4] <- length(which(GSE66099_sample$selected == 1))
sampleN[5] <- length(which(GSE36809_sample$selected == 1))
sampleN[6] <- length(which(GSE36809_sample$selected == 2))
sampleN[7] <- length(which(GSE36809_sample$selected == 3))
sampleN[8] <- length(which(GSE36809_sample$selected == 4))
sampleN[9] <- length(which(GSE36809_sample$selected == 5))
sampleN[10] <- length(which(GSE65682_sample$selected == 1))
sampleN[11] <- length(which(GSE74224_sample$selected == 1))
sampleN[12] <- length(which(EMEXP3589_sample$selected == 1))

weightedAUC_stanford <- sum(AUCs_stanford[1:9] %*% t(t(sampleN[1:9]))) / sum(sampleN[1:9])
weightedAUC <- rowSums(AUCs[,1:9] %*% t(t(sampleN[1:9]))) / sum(sampleN[1:9])
boxplot(weightedAUC)


# Top 250 / Bottom 250
orderid <- order(weightedAUC, decreasing=T)
top250Summary <- rand100000_gobp_mat[orderid[1:250],]
row.names(top250Summary) <- randGenes100000[orderid[1:250]]
colnames(top250Summary) <- GOBP82

write.table(top250Summary, "[path]/GOBP_summary_top250.txt", sep="\t")

bottom250Summary <- rand100000_gobp_mat[orderid[99751:100000],]
row.names(bottom250Summary) <- randGenes100000[orderid[99751:100000]]
colnames(bottom250Summary) <- GOBP82

write.table(bottom250Summary, "[path]/GOBP_summary_bottom250.txt", sep="\t")

sortedWeightedAUC <- sort(weightedAUC, decreasing=T)
plot(sortedWeightedAUC, 
     xlab = "Ranking",
     ylab = "Weighted AUC",
     cex = 1.5,
     cex.lab = 2,
     cex.axis = 2)

qTiles <- quantile(sortedWeightedAUC, probs=c(0,0.0025,0.9975,1))
abline(h=c(as.numeric(qTiles[2]), qTiles[3]), col=c("blue", "red"), lty=c(3,3), lwd=c(5,5))


# Curve for AUC
AUCvalues <- cbind("Top 250"=sortedWeightedAUC[1:250], 
      "Bottom 250"=sortedWeightedAUC[99751:100000])
boxplot(AUCvalues)
ttestRes <- t.test(AUCvalues[,1],AUCvalues[,2])

```



# 16. [Figure 2B] heatmap
```{r}
dim(top250Summary)
dim(bottom250Summary)

tid <- which(GOBP82_stanford11 == 1)
tMat <- cbind(t(top250Summary[,tid]),
              t(bottom250Summary[,tid]))

tMat <- tMat
cc <- c(rep("red", 1, ncol(tMat)/2), rep("yellow", 1, ncol(tMat)/2))
my_palette <- c("blue", "yellow", "green", "green", "green")
heatmap(as.matrix(tMat),
        col = my_palette,
        RowSideColors = rc,
        ColSideColors = cc,
        Colv = NA)

hv <- heatmap(as.matrix(tMat),
        col = my_palette,
        ColSideColors = cc,
        Colv = NA)
legend("topleft",      # location of the legend on the heatmap plot
    legend = c("0", "1", ">=2"), # category labels
    col = c("blue", "yellow", "green"),  # color key
    lty= 1,             # line style
    lwd = 10            # line width
)
```



# 17. [Figure 3] Gene substitution 
```{r}
data <- read.table("[path]/SubstitutableGenes.txt", sep="\t", header=T)
substitutionTable <- data[,2:ncol(data)]
row.names(substitutionTable) <- data[,1]
substitutionTable[is.na(substitutionTable) == 1] <- ""

numrow <- nrow(substitutionTable)
numcol <- ncol(substitutionTable)

AUCsTable_GSE28750 <- matrix(NA,10,numrow)
AUCsTable_GSE32707 <- matrix(NA,10,numrow)
AUCsTable_GSE40012 <- matrix(NA,10,numrow)
AUCsTable_GSE66099 <- matrix(NA,10,numrow)
AUCsTable_GSE36809_1 <- matrix(NA,10,numrow)
AUCsTable_GSE36809_2 <- matrix(NA,10,numrow)
AUCsTable_GSE36809_3 <- matrix(NA,10,numrow)
AUCsTable_GSE36809_4 <- matrix(NA,10,numrow)
AUCsTable_GSE36809_5 <- matrix(NA,10,numrow)
AUCsTable_GSE65682 <- matrix(NA,10,numrow)
AUCsTable_GSE74224 <- matrix(NA,10,numrow)
AUCsTable_EMEXP3589 <- matrix(NA,10,numrow)
substitutingGenesMatrix <- matrix(NA,10,numrow)
substitutedGenesMatrix <- matrix(NA,10,numrow)
for ( i in c(1:11) ) {
  tGenes <- stanford11.genes
  tGenesOri <- stanford11.genes[i]
  sGenes <- unlist(strsplit(setdiff(unique(as.factor(t(substitutionTable[i,]))), ""), ", "))
  if ( length(sGenes) != 0 ){
    for ( j in c(1:length(sGenes)) ) {
      tGenes[i] <- sGenes[j]
      substitutingGenesMatrix[j, i] <- tGenesOri
      substitutedGenesMatrix[j, i] <- tGenes[i]
      AUCsTable_GSE28750[j, i] <- auc(AUCcalc(GSE28750_expr, GSE28750_sample, tGenes))
      AUCsTable_GSE32707[j, i] <- auc(AUCcalc(GSE32707_expr, GSE32707_sample, tGenes))
      AUCsTable_GSE40012[j, i] <- auc(AUCcalc(GSE40012_expr, GSE40012_sample, tGenes))
      AUCsTable_GSE66099[j, i] <- auc(AUCcalc(GSE66099_expr, GSE66099_sample, tGenes))
      AUCsTable_GSE36809_1[j, i] <- auc(AUCcalc(GSE36809_expr1, GSE36809_sample1, tGenes))
      AUCsTable_GSE36809_2[j, i] <- auc(AUCcalc(GSE36809_expr2, GSE36809_sample2, tGenes))
      AUCsTable_GSE36809_3[j, i] <- auc(AUCcalc(GSE36809_expr3, GSE36809_sample3, tGenes))
      AUCsTable_GSE36809_4[j, i] <- auc(AUCcalc(GSE36809_expr4, GSE36809_sample4, tGenes))
      AUCsTable_GSE36809_5[j, i] <- auc(AUCcalc(GSE36809_expr5, GSE36809_sample5, tGenes))
      AUCsTable_GSE65682[j, i] <- auc(AUCcalc(GSE65682_expr, GSE65682_sample, tGenes))
      AUCsTable_GSE74224[j, i] <- auc(AUCcalc(GSE74224_expr, GSE74224_sample, tGenes))
      AUCsTable_EMEXP3589[j, i] <- auc(AUCcalc(EMEXP3589_expr, EMEXP3589_sample, tGenes))
    }
  }
}

# Barplot

# (Figure3A) BATF
i <- 1
tMat <- t(rbind(AUCsTable_GSE28750[, i],
                AUCsTable_GSE32707[, i],
                AUCsTable_GSE40012[, i],
                AUCsTable_GSE66099[, i],
                AUCsTable_GSE36809_1[, i],
                AUCsTable_GSE36809_2[, i],
                AUCsTable_GSE36809_3[, i],
                AUCsTable_GSE36809_4[, i],
                AUCsTable_GSE36809_5[, i],
                AUCsTable_GSE65682[, i],
                AUCsTable_GSE74224[, i],
                AUCsTable_EMEXP3589[, i]))
par(bty="o")
par(cex.lab=1.5)
par(cex.axis=1.1)
barplot(colMeans(tMat, na.rm=T), 
        las = 2, 
        names = c("GSE28750",
                  "GSE32707",
                  "GSE40012",
                  "GSE66099",
                  "GSE36809-1",
                  "GSE36809-2",
                  "GSE36809-3",
                  "GSE36809-4",
                  "GSE36809-5",
                  "GSE65682",
                  "GSE74224",
                  "E-MEXP-3589"),
        main = "BATF",
        ylim = c(0, 1))

# (Figure3B) C3AR1
i <- 2
tMat <- t(rbind(AUCsTable_GSE28750[, i],
                AUCsTable_GSE32707[, i],
                AUCsTable_GSE40012[, i],
                AUCsTable_GSE66099[, i],
                AUCsTable_GSE36809_1[, i],
                AUCsTable_GSE36809_2[, i],
                AUCsTable_GSE36809_3[, i],
                AUCsTable_GSE36809_4[, i],
                AUCsTable_GSE36809_5[, i],
                AUCsTable_GSE65682[, i],
                AUCsTable_GSE74224[, i],
                AUCsTable_EMEXP3589[, i]))
par(bty="o")
par(cex.lab=1.5)
par(cex.axis=1.1)
barplot(colMeans(tMat, na.rm=T), 
        las = 2, 
        names = c("GSE28750",
                  "GSE32707",
                  "GSE40012",
                  "GSE66099",
                  "GSE36809-1",
                  "GSE36809-2",
                  "GSE36809-3",
                  "GSE36809-4",
                  "GSE36809-5",
                  "GSE65682",
                  "GSE74224",
                  "E-MEXP-3589"),
        main = "C3AR1",
        ylim = c(0, 1))

# (Figure3C) C9orf95
i <- 3
tMat <- t(rbind(AUCsTable_GSE28750[, i],
                AUCsTable_GSE32707[, i],
                AUCsTable_GSE40012[, i],
                AUCsTable_GSE66099[, i],
                AUCsTable_GSE36809_1[, i],
                AUCsTable_GSE36809_2[, i],
                AUCsTable_GSE36809_3[, i],
                AUCsTable_GSE36809_4[, i],
                AUCsTable_GSE36809_5[, i],
                AUCsTable_GSE65682[, i],
                AUCsTable_GSE74224[, i],
                AUCsTable_EMEXP3589[, i]))
par(bty="o")
par(cex.lab=1.5)
par(cex.axis=1.1)
barplot(colMeans(tMat, na.rm=T), 
        las = 2, 
        names = c("GSE28750",
                  "GSE32707",
                  "GSE40012",
                  "GSE66099",
                  "GSE36809-1",
                  "GSE36809-2",
                  "GSE36809-3",
                  "GSE36809-4",
                  "GSE36809-5",
                  "GSE65682",
                  "GSE74224",
                  "E-MEXP-3589"),
        main = "C9orf95",
        ylim = c(0, 1))

# (Figure3D) CEACAM1
i <- 4
tMat <- t(rbind(AUCsTable_GSE28750[, i],
                AUCsTable_GSE32707[, i],
                AUCsTable_GSE40012[, i],
                AUCsTable_GSE66099[, i],
                AUCsTable_GSE36809_1[, i],
                AUCsTable_GSE36809_2[, i],
                AUCsTable_GSE36809_3[, i],
                AUCsTable_GSE36809_4[, i],
                AUCsTable_GSE36809_5[, i],
                AUCsTable_GSE65682[, i],
                AUCsTable_GSE74224[, i],
                AUCsTable_EMEXP3589[, i]))
par(bty="o")
par(cex.lab=1.5)
par(cex.axis=1.1)
barplot(colMeans(tMat, na.rm=T),  
        las = 2, 
        names = c("GSE28750",
                  "GSE32707",
                  "GSE40012",
                  "GSE66099",
                  "GSE36809-1",
                  "GSE36809-2",
                  "GSE36809-3",
                  "GSE36809-4",
                  "GSE36809-5",
                  "GSE65682",
                  "GSE74224",
                  "E-MEXP-3589"),
        main = "CEACAM1",
        ylim = c(0, 1))

# (Figure3E) GNA15
i <- 5
tMat <- t(rbind(AUCsTable_GSE28750[, i],
                AUCsTable_GSE32707[, i],
                AUCsTable_GSE40012[, i],
                AUCsTable_GSE66099[, i],
                AUCsTable_GSE36809_1[, i],
                AUCsTable_GSE36809_2[, i],
                AUCsTable_GSE36809_3[, i],
                AUCsTable_GSE36809_4[, i],
                AUCsTable_GSE36809_5[, i],
                AUCsTable_GSE65682[, i],
                AUCsTable_GSE74224[, i],
                AUCsTable_EMEXP3589[, i]))
par(bty="o")
par(cex.lab=1.5)
par(cex.axis=1.1)

barplot(colMeans(tMat, na.rm=T), 
        las = 2, 
        names = c("GSE28750",
                  "GSE32707",
                  "GSE40012",
                  "GSE66099",
                  "GSE36809-1",
                  "GSE36809-2",
                  "GSE36809-3",
                  "GSE36809-4",
                  "GSE36809-5",
                  "GSE65682",
                  "GSE74224",
                  "E-MEXP-3589"),
        main = "GNA15",
        ylim = c(0, 1))

# (Figure3F) MTCH1
i <- 9
tMat <- t(rbind(AUCsTable_GSE28750[, i],
                AUCsTable_GSE32707[, i],
                AUCsTable_GSE40012[, i],
                AUCsTable_GSE66099[, i],
                AUCsTable_GSE36809_1[, i],
                AUCsTable_GSE36809_2[, i],
                AUCsTable_GSE36809_3[, i],
                AUCsTable_GSE36809_4[, i],
                AUCsTable_GSE36809_5[, i],
                AUCsTable_GSE65682[, i],
                AUCsTable_GSE74224[, i],
                AUCsTable_EMEXP3589[, i]))
par(bty="o")
par(cex.lab=1.5)
par(cex.axis=1.1)
barplot(colMeans(tMat, na.rm=T), 
        las = 2, 
        names = c("GSE28750",
                  "GSE32707",
                  "GSE40012",
                  "GSE66099",
                  "GSE36809-1",
                  "GSE36809-2",
                  "GSE36809-3",
                  "GSE36809-4",
                  "GSE36809-5",
                  "GSE65682",
                  "GSE74224",
                  "E-MEXP-3589"),
        main = "MTCH1",
        ylim = c(0, 1))

# P-value calculation
ROCcomparePval <- function (data, sample, AUCtable) {
  sid <- c(1, 2, 3, 4, 5, 9)
  pvalueMat <- rep(1, 6)
  for ( i in 1:length(sid) ) {
    tAUCs <- cbind(substitutingGenesMatrix[,i], substitutedGenesMatrix[,i], AUCtable[,i])
    tAUCs <- tAUCs[which(is.na(tAUCs[,1]) == 0), ]
    tid <- which(tAUCs[, 3] == median(as.numeric(tAUCs[, 3])))
    ttGenes <- tAUCs[tid[1], 1:2]
    j <- which(stanford11.genes == ttGenes[1])
    tGenes <- stanford11.genes
    tGenes[j] <- ttGenes[2]
    tm <- AUCcalc(data, sample, stanford11.genes)
    tROC1 <- tm$auc
    tm <- AUCcalc(data, sample, stanford11.genes)
    tROC2 <- tm$auc
    ROCres <- roc.test(tROC1, tROC2, method="delong")
    pvalueMat[i] <- ROCres$p.value
  }
  return(pvalueMat)

}

Pvalue <- matrix(1, 6, 12)
Pvalue[,1] <- ROCcomparePval(GSE28750_expr, GSE28750_sample, AUCsTable_GSE28750)
Pvalue[,2] <- ROCcomparePval(GSE32707_expr, GSE32707_sample, AUCsTable_GSE32707)
Pvalue[,3] <- ROCcomparePval(GSE40012_expr, GSE40012_sample, AUCsTable_GSE40012)
Pvalue[,4] <- ROCcomparePval(GSE66099_expr, GSE66099_sample, AUCsTable_GSE66099)
Pvalue[,5] <- ROCcomparePval(GSE36809_expr1, GSE36809_sample1, AUCsTable_GSE36809_1)
Pvalue[,6] <- ROCcomparePval(GSE36809_expr2, GSE36809_sample2, AUCsTable_GSE36809_2)
Pvalue[,7] <- ROCcomparePval(GSE36809_expr3, GSE36809_sample3, AUCsTable_GSE36809_3)
Pvalue[,8] <- ROCcomparePval(GSE36809_expr4, GSE36809_sample4, AUCsTable_GSE36809_4)
Pvalue[,9] <- ROCcomparePval(GSE36809_expr5, GSE36809_sample5, AUCsTable_GSE36809_5)
Pvalue[,10] <- ROCcomparePval(GSE65682_expr, GSE65682_sample, AUCsTable_GSE65682)
Pvalue[,11] <- ROCcomparePval(GSE74224_expr, GSE74224_sample, AUCsTable_GSE74224)
Pvalue[,12] <- ROCcomparePval(EMEXP3589_expr, EMEXP3589_sample, AUCsTable_EMEXP3589)
```



# 18. [Figure 4] 6 gene substitution 
```{r}
data <- read.table("[path]/SubstitutableGenes.txt", sep="\t", header=T)
substitutionTable <- data[,2:ncol(data)]
row.names(substitutionTable) <- data[,1]
substitutionTable[is.na(substitutionTable) == 1] <- ""

numrow <- nrow(substitutionTable)
numcol <- ncol(substitutionTable)

BATF <- unlist(strsplit(setdiff(unique(as.factor(t(substitutionTable[1,]))), ""), ", "))
C3AR1 <- unlist(strsplit(setdiff(unique(as.factor(t(substitutionTable[2,]))), ""), ", "))
C9orf95 <- unlist(strsplit(setdiff(unique(as.factor(t(substitutionTable[3,]))), ""), ", "))
CEACAM1 <- unlist(strsplit(setdiff(unique(as.factor(t(substitutionTable[4,]))), ""), ", "))
GNA15 <- unlist(strsplit(setdiff(unique(as.factor(t(substitutionTable[5,]))), ""), ", "))
ZDHHC19 <- unlist(strsplit(setdiff(unique(as.factor(t(substitutionTable[6,]))), ""), ", "))
HLADPB1 <- unlist(strsplit(setdiff(unique(as.factor(t(substitutionTable[7,]))), ""), ", "))
KIAA1370 <- unlist(strsplit(setdiff(unique(as.factor(t(substitutionTable[8,]))), ""), ", "))
MTCH1 <- unlist(strsplit(setdiff(unique(as.factor(t(substitutionTable[9,]))), ""), ", "))
RPGRIP1 <- unlist(strsplit(setdiff(unique(as.factor(t(substitutionTable[10,]))), ""), ", "))
TGFBI <- unlist(strsplit(setdiff(unique(as.factor(t(substitutionTable[11,]))), ""), ", "))

#library(gtools)

tGeneList <- matrix('', 2000, 11)
iter <- 1
for ( i in c(1:2) ) {
  for ( j in c(1:10) ) {
    for ( k in c(1:2) ) {
      for ( l in c(1:10) ) {
        for ( m in c(1:5) ) {
          tGeneList[iter, 1] <- BATF[i]
          tGeneList[iter, 2] <- C3AR1[j]
          tGeneList[iter, 3] <- C9orf95[k]
          tGeneList[iter, 4] <- CEACAM1[l]
          tGeneList[iter, 5] <- GNA15[m]
          tGeneList[iter, 6] <- "ZDHHC19"
          tGeneList[iter, 7] <- "HLA-DPB1"
          tGeneList[iter, 8] <- "KIAA1370"
          tGeneList[iter, 9] <- "ARHGEF18"
          tGeneList[iter, 10] <- "RPGRIP1"
          tGeneList[iter, 11] <- "TGFBI"
          iter <- iter + 1
        }
      }
    }
  }
}

noGenes <- rep(0, 2000)
for ( i in c(1:2000) ) {
  tGenes <- tGeneList[i, ]
  noGenes[i] <- length(unique(tGenes))
}
selid <- which(noGenes == 11)

randGenes <- matrix("", 2000, 1)
AUCsTable_6substitutes_figure5 <- matrix(0, 2000, 12)
for ( i in c(1:2000) ) {
  tGenes <- tGeneList[i,]
  randGenes[i] <- paste(tGenes, collapse=", ")
  AUCsTable_6substitutes_figure5[i, 1] <- auc(AUCcalc(GSE28750_expr, GSE28750_sample, tGenes))
  AUCsTable_6substitutes_figure5[i, 2] <- auc(AUCcalc(GSE32707_expr, GSE32707_sample, tGenes))
  AUCsTable_6substitutes_figure5[i, 3] <- auc(AUCcalc(GSE40012_expr, GSE40012_sample, tGenes))
  AUCsTable_6substitutes_figure5[i, 4] <- auc(AUCcalc(GSE66099_expr, GSE66099_sample, tGenes))
  AUCsTable_6substitutes_figure5[i, 5] <- auc(AUCcalc(GSE36809_expr1, GSE36809_sample1, tGenes))
  AUCsTable_6substitutes_figure5[i, 6] <- auc(AUCcalc(GSE36809_expr2, GSE36809_sample2, tGenes))
  AUCsTable_6substitutes_figure5[i, 7] <- auc(AUCcalc(GSE36809_expr3, GSE36809_sample3, tGenes))
  AUCsTable_6substitutes_figure5[i, 8] <- auc(AUCcalc(GSE36809_expr4, GSE36809_sample4, tGenes))
  AUCsTable_6substitutes_figure5[i, 9] <- auc(AUCcalc(GSE36809_expr5, GSE36809_sample5, tGenes))
  AUCsTable_6substitutes_figure5[i, 10] <- auc(AUCcalc(GSE65682_expr, GSE65682_sample, tGenes))
  AUCsTable_6substitutes_figure5[i, 11] <- auc(AUCcalc(GSE74224_expr, GSE74224_sample, tGenes))
  AUCsTable_6substitutes_figure5[i, 12] <- auc(AUCcalc(EMEXP3589_expr, EMEXP3589_sample, tGenes))
 
}

barplot(colMeans(AUCsTable_6substitutes_figure5[noGenes==11, ], na.rm=T),
        las = 2,
        names = c("GSE28750",
                  "GSE32707",
                  "GSE40012",
                  "GSE66099",
                  "GSE36809-1",
                  "GSE36809-2",
                  "GSE36809-3",
                  "GSE36809-4",
                  "GSE36809-5",
                  "GSE65682",
                  "GSE74224",
                  "E-MEXP-3589"),
        main="6 gene substitutes")

ROCcompare6GenesPval <- function (data, sample, AUCtable) {
  tAUCs <- cbind(tGeneList[selid,], AUCtable[selid])
  tid <- which(tAUCs[, 12] == median(as.numeric(tAUCs[, 12])))
  tGenes <- tAUCs[tid[1], 1:11]
  tROC1 <- AUCcalc(data, sample, stanford11.genes)
  tROC2 <- AUCcalc(data, sample, tGenes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  return(ROCres$p.value)
}
p <- rep(1, 12)
p[1] <- ROCcompare6GenesPval(GSE28750_expr, GSE28750_sample, AUCsTable_6substitutes_figure5[,1])
p[2] <- ROCcompare6GenesPval(GSE32707_expr, GSE32707_sample, AUCsTable_6substitutes_figure5[,2])
p[3] <- ROCcompare6GenesPval(GSE40012_expr, GSE40012_sample, AUCsTable_6substitutes_figure5[,3])
p[4] <- ROCcompare6GenesPval(GSE66099_expr, GSE66099_sample, AUCsTable_6substitutes_figure5[,4])
p[5] <- ROCcompare6GenesPval(GSE36809_expr1, GSE36809_sample1, AUCsTable_6substitutes_figure5[,5])
p[6] <- ROCcompare6GenesPval(GSE36809_expr2, GSE36809_sample2, AUCsTable_6substitutes_figure5[,6])
p[7] <- ROCcompare6GenesPval(GSE36809_expr3, GSE36809_sample3, AUCsTable_6substitutes_figure5[,7])
p[8] <- ROCcompare6GenesPval(GSE36809_expr4, GSE36809_sample4, AUCsTable_6substitutes_figure5[,8])
p[9] <- ROCcompare6GenesPval(GSE36809_expr5, GSE36809_sample5, AUCsTable_6substitutes_figure5[,9])
p[10] <- ROCcompare6GenesPval(GSE65682_expr, GSE65682_sample, AUCsTable_6substitutes_figure5[,10])
p[11] <- ROCcompare6GenesPval(GSE74224_expr, GSE74224_sample, AUCsTable_6substitutes_figure5[,11])
p[12] <- ROCcompare6GenesPval(EMEXP3589_expr, EMEXP3589_sample, AUCsTable_6substitutes_figure5[,12])

write.table(AUCsTable_6substitutes_figure5, "[path]/AUCsTable_6substitutes_figure5.txt", sep="\t")
write.table(tGeneList, "[path]/AUCsTable_6substitutes_figure5_gene.txt", sep="\t")

```



# 19. [Figure 5] Gene reduction using one biological process 
```{r}
# 1) gene reduction in PLC, phosphorylation, platelet activation function
tGeneList_BP1 <- matrix("",2,10)
tGeneList_BP1[1,] <- c("BATF",
                      "C3AR1",
                      "C9orf95",
                      "CEACAM1",
                      "ZDHHC19",
                      "HLA-DPB1",
                      "KIAA1370",
                      "MTCH1",
                      "RPGRIP1",
                      "TGFBI")

tGeneList_BP1[2,] <- c("BATF",
                      "C9orf95",
                      "CEACAM1",
                      "GNA15",  
                      "ZDHHC19",
                      "HLA-DPB1",
                      "KIAA1370",
                      "MTCH1",
                      "RPGRIP1",
                      "TGFBI")
# 2) gene reduction in chemotaxis, angiogenesis, adhesion, migration
tGeneList_BP2 <- matrix("",4,8)
tGeneList_BP2[1,] <- c("BATF",
                      "C3AR1",
                      "C9orf95",
                      "ZDHHC19",
                      "HLA-DPB1",
                      "KIAA1370",
                      "MTCH1",
                      "RPGRIP1")
  
tGeneList_BP2[2,] <- c("BATF",
                      "C9orf95",
                      "CEACAM1",
                      "ZDHHC19",
                      "HLA-DPB1",
                      "KIAA1370",
                      "MTCH1",
                      "RPGRIP1")

tGeneList_BP2[3,] <- c("BATF",
                      "C9orf95",
                      "GNA15",
                      "ZDHHC19",
                      "HLA-DPB1",
                      "KIAA1370",
                      "MTCH1",
                      "RPGRIP1")

tGeneList_BP2[4,] <- c("BATF",
                      "C9orf95",
                      "ZDHHC19",
                      "HLA-DPB1",
                      "KIAA1370",
                      "MTCH1",
                      "RPGRIP1",
                      "TGFBI")


# 3) gene reduction in both process
tGeneList_BP3 <- matrix("",5,9)
tGeneList_BP3[1,] <- c("BATF",
                      "C3AR1",
                      "C9orf95",
                      "GNA15",
                      "ZDHHC19",
                      "HLA-DPB1",
                      "KIAA1370",
                      "MTCH1",
                      "RPGRIP1")
  
tGeneList_BP3[2,] <- c("BATF",
                      "C3AR1",
                      "C9orf95",
                      "CEACAM1",
                      "ZDHHC19",
                      "HLA-DPB1",
                      "KIAA1370",
                      "MTCH1",
                      "RPGRIP1")

tGeneList_BP3[3,] <- c("BATF",
                      "C3AR1",
                      "C9orf95",
                      "ZDHHC19",
                      "HLA-DPB1",
                      "KIAA1370",
                      "MTCH1",
                      "RPGRIP1",
                      "TGFBI")

tGeneList_BP3[4,] <- c("BATF",
                      "C9orf95",
                      "GNA15",
                      "CEACAM1",
                      "ZDHHC19",
                      "HLA-DPB1",
                      "KIAA1370",
                      "MTCH1",
                      "RPGRIP1")

tGeneList_BP3[5,] <- c("BATF",
                      "C9orf95",
                      "GNA15",
                      "ZDHHC19",
                      "HLA-DPB1",
                      "KIAA1370",
                      "MTCH1",
                      "RPGRIP1",
                      "TGFBI")

# Figure 5A
AUCsTable_redunction_BP1 <- matrix(0, 2, 12)

p <- matrix(1, 2, 12)
for ( i in c(1:2) ) {
  tGenes <- tGeneList_BP1[i,]
  #randGenes[i] <- paste(tGenes, collapse=", ")
  tROC1 <- AUCcalc(GSE28750_expr, GSE28750_sample, tGenes)
  AUCsTable_redunction_BP1[i, 1] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE28750_expr, GSE28750_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 1] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE32707_expr, GSE32707_sample, tGenes)
  AUCsTable_redunction_BP1[i, 2] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE32707_expr, GSE32707_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 2] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE40012_expr, GSE40012_sample, tGenes)
  AUCsTable_redunction_BP1[i, 3] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE40012_expr, GSE40012_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 3] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE66099_expr, GSE66099_sample, tGenes)
  AUCsTable_redunction_BP1[i, 4] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE66099_expr, GSE66099_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 4] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr1, GSE36809_sample1, tGenes)
  AUCsTable_redunction_BP1[i, 5] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr1, GSE36809_sample1, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 5] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr2, GSE36809_sample2, tGenes)
  AUCsTable_redunction_BP1[i, 6] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr2, GSE36809_sample2, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 6] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr3, GSE36809_sample3, tGenes)
  AUCsTable_redunction_BP1[i, 7] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr3, GSE36809_sample3, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 7] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr4, GSE36809_sample4, tGenes)
  AUCsTable_redunction_BP1[i, 8] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr4, GSE36809_sample4, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 8] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr5, GSE36809_sample5, tGenes)
  AUCsTable_redunction_BP1[i, 9] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr5, GSE36809_sample5, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 9] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE65682_expr, GSE65682_sample, tGenes)
  AUCsTable_redunction_BP1[i, 10] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE65682_expr, GSE65682_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 10] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE74224_expr, GSE74224_sample, tGenes)
  AUCsTable_redunction_BP1[i, 11] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE74224_expr, GSE74224_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 11] <- ROCres$p.value
  tROC1 <- AUCcalc(EMEXP3589_expr, EMEXP3589_sample, tGenes)
  AUCsTable_redunction_BP1[i, 12] <- auc(tROC1)
  tROC2 <- AUCcalc(EMEXP3589_expr, EMEXP3589_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 12] <- ROCres$p.value
}

# Figure 5B
AUCsTable_redunction_BP2 <- matrix(0, 4, 12)

p <- matrix(1, 4, 12)
for ( i in c(1:4) ) {
  tGenes <- tGeneList_BP2[i,]
  #randGenes[i] <- paste(tGenes, collapse=", ")
  tROC1 <- AUCcalc(GSE28750_expr, GSE28750_sample, tGenes)
  AUCsTable_redunction_BP2[i, 1] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE28750_expr, GSE28750_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 1] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE32707_expr, GSE32707_sample, tGenes)
  AUCsTable_redunction_BP2[i, 2] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE32707_expr, GSE32707_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 2] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE40012_expr, GSE40012_sample, tGenes)
  AUCsTable_redunction_BP2[i, 3] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE40012_expr, GSE40012_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 3] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE66099_expr, GSE66099_sample, tGenes)
  AUCsTable_redunction_BP2[i, 4] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE66099_expr, GSE66099_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 4] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr1, GSE36809_sample1, tGenes)
  AUCsTable_redunction_BP2[i, 5] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr1, GSE36809_sample1, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 5] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr2, GSE36809_sample2, tGenes)
  AUCsTable_redunction_BP2[i, 6] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr2, GSE36809_sample2, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 6] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr3, GSE36809_sample3, tGenes)
  AUCsTable_redunction_BP2[i, 7] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr3, GSE36809_sample3, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 7] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr4, GSE36809_sample4, tGenes)
  AUCsTable_redunction_BP2[i, 8] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr4, GSE36809_sample4, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 8] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr5, GSE36809_sample5, tGenes)
  AUCsTable_redunction_BP2[i, 9] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr5, GSE36809_sample5, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 9] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE65682_expr, GSE65682_sample, tGenes)
  AUCsTable_redunction_BP2[i, 10] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE65682_expr, GSE65682_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 10] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE74224_expr, GSE74224_sample, tGenes)
  AUCsTable_redunction_BP2[i, 11] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE74224_expr, GSE74224_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 11] <- ROCres$p.value
  tROC1 <- AUCcalc(EMEXP3589_expr, EMEXP3589_sample, tGenes)
  AUCsTable_redunction_BP2[i, 12] <- auc(tROC1)
  tROC2 <- AUCcalc(EMEXP3589_expr, EMEXP3589_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 12] <- ROCres$p.value
}

# Figure 5C
AUCsTable_redunction_BP3 <- matrix(0, 5, 12)
p <- matrix(1, 5, 12)

for ( i in c(1:5) ) {
  tGenes <- tGeneList_BP3[i,]
  #randGenes[i] <- paste(tGenes, collapse=", ")
  tROC1 <- AUCcalc(GSE28750_expr, GSE28750_sample, tGenes)
  AUCsTable_redunction_BP3[i, 1] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE28750_expr, GSE28750_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 1] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE32707_expr, GSE32707_sample, tGenes)
  AUCsTable_redunction_BP3[i, 2] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE32707_expr, GSE32707_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 2] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE40012_expr, GSE40012_sample, tGenes)
  AUCsTable_redunction_BP3[i, 3] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE40012_expr, GSE40012_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 3] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE66099_expr, GSE66099_sample, tGenes)
  AUCsTable_redunction_BP3[i, 4] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE66099_expr, GSE66099_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 4] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr1, GSE36809_sample1, tGenes)
  AUCsTable_redunction_BP3[i, 5] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr1, GSE36809_sample1, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 5] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr2, GSE36809_sample2, tGenes)
  AUCsTable_redunction_BP3[i, 6] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr2, GSE36809_sample2, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 6] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr3, GSE36809_sample3, tGenes)
  AUCsTable_redunction_BP3[i, 7] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr3, GSE36809_sample3, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 7] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr4, GSE36809_sample4, tGenes)
  AUCsTable_redunction_BP3[i, 8] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr4, GSE36809_sample4, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 8] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE36809_expr5, GSE36809_sample5, tGenes)
  AUCsTable_redunction_BP3[i, 9] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE36809_expr5, GSE36809_sample5, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 9] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE65682_expr, GSE65682_sample, tGenes)
  AUCsTable_redunction_BP3[i, 10] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE65682_expr, GSE65682_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 10] <- ROCres$p.value
  tROC1 <- AUCcalc(GSE74224_expr, GSE74224_sample, tGenes)
  AUCsTable_redunction_BP3[i, 11] <- auc(tROC1)
  tROC2 <- AUCcalc(GSE74224_expr, GSE74224_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 11] <- ROCres$p.value
  tROC1 <- AUCcalc(EMEXP3589_expr, EMEXP3589_sample, tGenes)
  AUCsTable_redunction_BP3[i, 12] <- auc(tROC1)
  tROC2 <- AUCcalc(EMEXP3589_expr, EMEXP3589_sample, stanford11.genes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  p[i, 12] <- ROCres$p.value
}

lab <- c("GSE28750",
        "GSE32707",
        "GSE40012",
        "GSE66099",
        "GSE36809-1",
        "GSE36809-2",
        "GSE36809-3",
        "GSE36809-4",
        "GSE36809-5",
        "GSE65682",
        "GSE74224",
        "E-MEXP-3589")

par(mfrow=c(1,3))
par(bty="o")
par(cex.lab=1.5)
par(cex.axis=1.2)
barplot(colMeans(AUCsTable_redunction_BP1, na.rm=T), 
        las = 2, names = lab, ylim=c(0.65, 1),
        main="PLC, phosphorylation, platelet activation function")
barplot(colMeans(AUCsTable_redunction_BP2, na.rm=T), 
        las = 2, names = lab, ylim=c(0.65, 1), 
        main="chemotaxis, angiogenesis, adhesion, migration")
barplot(colMeans(AUCsTable_redunction_BP3, na.rm=T), 
        las = 2, names = lab, ylim=c(0.65, 1), 
        main="Both")

```



# 20. [Figure 6] Gene reduction (to 6 six genes based on 6 key biological processes)
```{r}
data <- read.table("[path]/GOBPSubstitutableGenes.txt", sep="\t", header=T)
substitutionTable <- data

numrow <- nrow(substitutionTable)
numcol <- ncol(substitutionTable)

BP1 <- setdiff(substitutionTable[,1], "")
BP2 <- setdiff(substitutionTable[,2], "")
BP3 <- setdiff(substitutionTable[,3], "")
BP4 <- setdiff(substitutionTable[,4], "")
BP5 <- setdiff(substitutionTable[,5], "")
BP6 <- setdiff(substitutionTable[,6], "")

#library(gtools)
nTotal <- length(BP1) * length(BP2) * length(BP3) * length(BP4) * length(BP5) * length(BP6) 
tGeneList <- matrix('', nTotal, 6)
selid <- rep(0, nTotal)
iter <- 1
for ( i in c(1:length(BP1)) ) {
  for ( j in c(1:length(BP2)) ) {
    for ( k in c(1:length(BP3)) ) {
      for ( l in c(1:length(BP4)) ) {
        for ( m in c(1:length(BP5)) ) {
          for ( n in c(1:length(BP6)) ) {
            tGeneList[iter, 1] <- BP1[i]
            tGeneList[iter, 2] <- BP2[j]
            tGeneList[iter, 3] <- BP3[k]
            tGeneList[iter, 4] <- BP4[l]
            tGeneList[iter, 5] <- BP5[m]
            tGeneList[iter, 6] <- BP6[n]
            selid[iter] <- length(unique(tGeneList[iter, ]))
            iter <- iter + 1
            
          }
        }
      }
    }
  }
}


tGeneListSort <- matrix('', nTotal, 1)
for ( i in c(1:nTotal) ){
  tGeneListSort[i] <- paste(sort(tGeneList[i,]), collapse=", ")
}
write.table(tGeneListSort, "[path]/tGenesListSort_Figure7.txt", sep="\t")


AUCsTable_6substitutes <- matrix(0, nTotal, 12)
for ( i in c(1:nTotal) ) {
  tGenes <- tGeneList[i,]
  AUCsTable_6substitutes[i, 1] <- auc(AUCcalc(GSE28750_expr, GSE28750_sample, tGenes))
  AUCsTable_6substitutes[i, 2] <- auc(AUCcalc(GSE32707_expr, GSE32707_sample, tGenes))
  AUCsTable_6substitutes[i, 3] <- auc(AUCcalc(GSE40012_expr, GSE40012_sample, tGenes))
  AUCsTable_6substitutes[i, 4] <- auc(AUCcalc(GSE66099_expr, GSE66099_sample, tGenes))
  AUCsTable_6substitutes[i, 5] <- auc(AUCcalc(GSE36809_expr1, GSE36809_sample1, tGenes))
  AUCsTable_6substitutes[i, 6] <- auc(AUCcalc(GSE36809_expr2, GSE36809_sample2, tGenes))
  AUCsTable_6substitutes[i, 7] <- auc(AUCcalc(GSE36809_expr3, GSE36809_sample3, tGenes))
  AUCsTable_6substitutes[i, 8] <- auc(AUCcalc(GSE36809_expr4, GSE36809_sample4, tGenes))
  AUCsTable_6substitutes[i, 9] <- auc(AUCcalc(GSE36809_expr5, GSE36809_sample5, tGenes))
  AUCsTable_6substitutes[i, 10] <- auc(AUCcalc(GSE65682_expr, GSE65682_sample, tGenes))
  AUCsTable_6substitutes[i, 11] <- auc(AUCcalc(GSE74224_expr, GSE74224_sample, tGenes))
  AUCsTable_6substitutes[i, 12] <- auc(AUCcalc(EMEXP3589_expr, EMEXP3589_sample, tGenes))
}

ROCcompare6GenesPval <- function (data, sample, AUCtable) {
  tAUCs <- cbind(tGeneList[selid,], AUCtable[selid])
  tid <- which(tAUCs[, 7] == median(as.numeric(tAUCs[, 7])))
  tGenes <- tAUCs[tid[1], 1:6]
  tROC1 <- AUCcalc(data, sample, stanford11.genes)
  tROC2 <- AUCcalc(data, sample, tGenes)
  ROCres <- roc.test(tROC1, tROC2, method="delong")
  return(ROCres$p.value)
}

p <- rep(1, 12)
p[1] <- ROCcompare6GenesPval(GSE28750_expr, GSE28750_sample, AUCsTable_6substitutes[,1])
p[2] <- ROCcompare6GenesPval(GSE32707_expr, GSE32707_sample, AUCsTable_6substitutes[,2])
p[3] <- ROCcompare6GenesPval(GSE40012_expr, GSE40012_sample, AUCsTable_6substitutes[,3])
p[4] <- ROCcompare6GenesPval(GSE66099_expr, GSE66099_sample, AUCsTable_6substitutes[,4])
p[5] <- ROCcompare6GenesPval(GSE36809_expr1, GSE36809_sample1, AUCsTable_6substitutes[,5])
p[6] <- ROCcompare6GenesPval(GSE36809_expr2, GSE36809_sample2, AUCsTable_6substitutes[,6])
p[7] <- ROCcompare6GenesPval(GSE36809_expr3, GSE36809_sample3, AUCsTable_6substitutes[,7])
p[8] <- ROCcompare6GenesPval(GSE36809_expr4, GSE36809_sample4, AUCsTable_6substitutes[,8])
p[9] <- ROCcompare6GenesPval(GSE36809_expr5, GSE36809_sample5, AUCsTable_6substitutes[,9])
p[10] <- ROCcompare6GenesPval(GSE65682_expr, GSE65682_sample, AUCsTable_6substitutes[,10])
p[11] <- ROCcompare6GenesPval(GSE74224_expr, GSE74224_sample, AUCsTable_6substitutes[,11])
p[12] <- ROCcompare6GenesPval(EMEXP3589_expr, EMEXP3589_sample, AUCsTable_6substitutes[,12])

barplot(AUCsTable_6substitutes, las = 2,
        names = c("GSE28750",
                  "GSE32707",
                  "GSE40012",
                  "GSE66099",
                  "GSE36809-1",
                  "GSE36809-2",
                  "GSE36809-3",
                  "GSE36809-4",
                  "GSE36809-5",
                  "GSE65682",
                  "GSE74224",
                  "E-MEXP-3589"),
        main="6 gene substitutes")

write.table(AUCsTable_6substitutes, "[path]/AUCsTable_6substitutes.txt", sep="\t")
write.table(tGeneList, "[path]/AUCsTable_6substitutes_genes.txt", sep="\t")

nGenes <- matrix(0, nrow(tGeneList), 1)
for ( i in c(1:nrow(tGeneList))) {
  nGenes[i] <- length(unique(tGeneList[i,]))
}
write.table(nGenes, "[path]/nGenes_Figure7.txt", sep="\t")

AUCsTable_6substitutes <- read.table("[path]/AUCsTable_6substitutes.txt", sep="\t", header = T)

```



# 21. [Figure 7C] k-Top scoring pairs
```{r}
matTraining <- cbind(GSE28750_expr,
                    GSE32707_expr,
                    GSE40012_expr,
                    GSE66099_expr,
                    GSE36809_expr1,
                    GSE36809_expr2,
                    GSE36809_expr3,
                    GSE36809_expr4,
                    GSE36809_expr5)
matTraining_group <- as.factor(c(as.character(GSE28750_sample$group),
                         as.character(GSE32707_sample$group),
                         as.character(GSE40012_sample$group),
                         as.character(GSE66099_sample$group),
                         as.character(GSE36809_sample1$group),
                         as.character(GSE36809_sample2$group),
                         as.character(GSE36809_sample3$group),
                         as.character(GSE36809_sample4$group),
                         as.character(GSE36809_sample5$group)))
matTraining_group_number <- as.numeric(matTraining_group) - 1

row.names(matTraining) <- stanford82.genes

classifier <- SWAP.KTSP.Train(matTraining, matTraining_group, krange=c(3:15))
ktspStatDefault <- SWAP.KTSP.Statistics(inputMat = matTraining, classifier = classifier)
testPrediction <- SWAP.KTSP.Classify(matTraining, classifier)

write.table(ktspStatDefault$comparisons, "[path]/kTSP_result.txt", sep="\t")
write.table(matTraining_group, "[path]/kTSP_groups.txt", sep="\t")


matTesting <- cbind(GSE65682_expr,
                    GSE74224_expr,
                    EMEXP3589_expr)
matTesting_group <- as.factor(c(as.character(GSE65682_sample$group),
                         as.character(GSE74224_sample$group),
                         as.character(EMEXP3589_sample$group)))
row.names(matTesting) <- stanford82.genes
testPrediction <- SWAP.KTSP.Classify(matTesting, classifier)
write.table(testPrediction, "[path]/kTSP_testResult.txt", sep="\t")

# training
ktsp <- KTSP.Train(matTraining, matTraining_group_number, n=3)
AUCsTSP <- rep(0, 12)
pVal <- matrix(0, 12, 1)

# testing
# GSE28750
i <- 1
matTesting <- GSE28750_expr
row.names(matTesting) <- stanford82.genes
matTesting_group_number <- as.numeric(factor(GSE28750_sample$group)) - 1

pred <- KTSP.Classify(matTesting, ktsp, combineFunc = sum)
perf <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
AUCsTSP[i] <- auc(perf)

tROC1 <- AUCcalc_org(GSE28750_expr, GSE28750_sample, stanford11.genes)
tROC2 <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
ROCres <- roc.test(tROC1, tROC2, method="delong")
pVal[i,1] <- ROCres$p.value

# GSE32707
i <- 2
matTesting <- GSE32707_expr
row.names(matTesting) <- stanford82.genes
matTesting_group_number <- as.numeric(factor(GSE32707_sample$group)) - 1

pred <- KTSP.Classify(matTesting, ktsp, combineFunc = sum)
perf <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
AUCsTSP[i] <- auc(perf)

tROC1 <- auc(AUCcalc(GSE32707_expr, GSE32707_sample, stanford11.genes))
tROC2 <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
ROCres <- roc.test(tROC1, tROC2, method="delong")
pVal[i,1] <- ROCres$p.value

# GSE40012
i <- 3
matTesting <- GSE40012_expr
row.names(matTesting) <- stanford82.genes
matTesting_group_number <- as.numeric(factor(GSE40012_sample$group)) - 1

pred <- KTSP.Classify(matTesting, ktsp, combineFunc = sum)
perf <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
AUCsTSP[i] <- auc(perf)

tROC1 <- auc(AUCcalc(GGSE40012_expr, GSE40012_sample, stanford11.genes))
tROC2 <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
ROCres <- roc.test(tROC1, tROC2, method="delong")
pVal[i,1] <- ROCres$p.value

# GSE66099
i <- 4
matTesting <- GSE66099_expr
row.names(matTesting) <- stanford82.genes
matTesting_group_number <- as.numeric(factor(GSE66099_sample$group)) - 1

pred <- KTSP.Classify(matTesting, ktsp, combineFunc = sum)
perf <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
AUCsTSP[i] <- auc(perf)

tROC1 <- auc(AUCcalc(GSE66099_expr, GSE66099_sample, stanford11.genes))
tROC2 <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
ROCres <- roc.test(tROC1, tROC2, method="delong")
pVal[i,1] <- ROCres$p.value

# GSE36809-1
i <- 5
matTesting <- GSE36809_expr1
row.names(matTesting) <- stanford82.genes
matTesting_group_number <- as.numeric(factor(GSE36809_sample1$group)) - 1

pred <- KTSP.Classify(matTesting, ktsp, combineFunc = sum)
perf <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
AUCsTSP[i] <- auc(perf)

tROC1 <- auc(AUCcalc(GSE36809_expr1, GSE36809_sample1, stanford11.genes))
tROC2 <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
ROCres <- roc.test(tROC1, tROC2, method="delong")
pVal[i,1] <- ROCres$p.value

# GSE36809-2
i <- 6
matTesting <- GSE36809_expr2
row.names(matTesting) <- stanford82.genes
matTesting_group_number <- as.numeric(factor(GSE36809_sample2$group)) - 1

pred <- KTSP.Classify(matTesting, ktsp, combineFunc = sum)
perf <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
AUCsTSP[i] <- auc(perf)

tROC1 <- auc(AUCcalc(GSE36809_expr2, GSE36809_sample2, stanford11.genes))
tROC2 <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
ROCres <- roc.test(tROC1, tROC2, method="delong")
pVal[i,1] <- ROCres$p.value


# GSE36809-3
i <- 7
matTesting <- GSE36809_expr3
row.names(matTesting) <- stanford82.genes
matTesting_group_number <- as.numeric(factor(GSE36809_sample3$group)) - 1

pred <- KTSP.Classify(matTesting, ktsp, combineFunc = sum)
perf <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
AUCsTSP[i] <- auc(perf)

tROC1 <- auc(AUCcalc(GSE36809_expr3, GSE36809_sample3, stanford11.genes))
tROC2 <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
ROCres <- roc.test(tROC1, tROC2, method="delong")
pVal[i,1] <- ROCres$p.value


# GSE36809-4
i <- 8
matTesting <- GSE36809_expr4
row.names(matTesting) <- stanford82.genes
matTesting_group_number <- as.numeric(factor(GSE36809_sample4$group)) - 1

pred <- KTSP.Classify(matTesting, ktsp, combineFunc = sum)
perf <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
AUCsTSP[i] <- auc(perf)

tROC1 <- auc(AUCcalc(GSE36809_expr4, GSE36809_sample4, stanford11.genes))
tROC2 <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
ROCres <- roc.test(tROC1, tROC2, method="delong")
pVal[i,1] <- ROCres$p.value

# GSE36809-5
i <- 9
matTesting <- GSE36809_expr5
row.names(matTesting) <- stanford82.genes
matTesting_group_number <- as.numeric(factor(GSE36809_sample5$group)) - 1

pred <- KTSP.Classify(matTesting, ktsp, combineFunc = sum)
perf <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
AUCsTSP[i] <- auc(perf)

tROC1 <- auc(AUCcalc(GSE36809_expr5, GSE36809_sample5, stanford11.genes))
tROC2 <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
ROCres <- roc.test(tROC1, tROC2, method="delong")
pVal[i,1] <- ROCres$p.value

# GSE65682
i <- 10
matTesting <- GSE65682_expr
row.names(matTesting) <- stanford82.genes
matTesting_group_number <- as.numeric(factor(GSE65682_sample$group)) - 1

pred <- KTSP.Classify(matTesting, ktsp, combineFunc = sum)
perf <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
AUCsTSP[i] <- auc(perf)

tROC1 <- auc(AUCcalc(GSE65682_expr, GSE65682_sample, stanford11.genes))
tROC2 <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
ROCres <- roc.test(tROC1, tROC2, method="delong")
pVal[i,1] <- ROCres$p.value

# GSE74224
i <- 11
matTesting <- GSE74224_expr
row.names(matTesting) <- stanford82.genes
matTesting_group_number <- as.numeric(factor(GSE74224_sample$group)) - 1

pred <- KTSP.Classify(matTesting, ktsp, combineFunc = sum)
perf <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
AUCsTSP[i] <- auc(perf)

tROC1 <- auc(AUCcalc(GSE74224_expr, GSE74224_sample, stanford11.genes))
tROC2 <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
ROCres <- roc.test(tROC1, tROC2, method="delong")
pVal[i,1] <- ROCres$p.value

# EMeXP3589 
i <- 12
matTesting <- EMEXP3589_expr
row.names(matTesting) <- stanford82.genes
matTesting_group_number <- as.numeric(factor(EMEXP3589_sample$group)) - 1

pred <- KTSP.Classify(matTesting, ktsp, combineFunc = sum)
perf <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
AUCsTSP[i] <- auc(perf)

tROC1 <- auc(AUCcalc(EMEXP3589_expr, EMEXP3589_sample, stanford11.genes))
tROC2 <- roc(!matTesting_group_number, pred, ci=FALSE, plot=FALSE)
ROCres <- roc.test(tROC1, tROC2, method="delong")
pVal[i,1] <- ROCres$p.value

```